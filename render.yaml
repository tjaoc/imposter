# Blueprint Render — Plan Hobby (gratuito)
# Spec: https://render.com/docs/blueprint-spec
# Pricing: https://render.com/pricing — Hobby: 1 project, 2 environments; plan: free = $0/mes.
# Variables MONGODB_URI (sync: false), CORS_ORIGIN, VITE_*: configurar en Dashboard.
# Custom domains: añadir en Dashboard → Settings → Custom Domains.

projects:
  - name: imposter
    environments:
      - name: production
        services:
          - type: web
            runtime: node
            name: imposter-api-prod
            plan: free
            rootDir: backend
            buildCommand: npm install
            startCommand: npm start
            healthCheckPath: /health
            envVars:
              - key: NODE_ENV
                value: production
              - key: MONGODB_URI
                sync: false
              - key: CORS_ORIGIN
                value: https://impostor.netic.app

          - type: web
            runtime: static
            name: imposter-app-prod
            rootDir: frontend
            buildCommand: npm install && npm run build
            staticPublishPath: dist
            routes:
              - type: rewrite
                source: /*
                destination: /index.html
            envVars:
              - key: VITE_API_URL
                value: https://apiimp.netic.app
              - key: VITE_SOCKET_URL
                value: https://apiimp.netic.app

          # Actualización mensual de palabras (día 1, 00:00 UTC). Requiere plan de pago (cron no está en free).
          # En Dashboard: MONGODB_URI (producción) y opcionalmente GITHUB_TOKEN para commit+push.
          - type: cron
            name: imposter-words-monthly
            runtime: node
            schedule: "0 0 1 * *"
            buildCommand: cd backend && npm install
            startCommand: node scripts/update-words-monthly.js
            envVars:
              - key: MONGODB_URI
                sync: false
              - key: GITHUB_TOKEN
                sync: false

      - name: development
        services:
          - type: web
            runtime: node
            name: imposter-api-dev
            plan: free
            rootDir: backend
            buildCommand: npm install
            startCommand: npm start
            healthCheckPath: /health
            envVars:
              - key: NODE_ENV
                value: development
              - key: MONGODB_URI
                sync: false
              - key: CORS_ORIGIN
                value: https://impostor.netic.dev

          - type: web
            runtime: static
            name: imposter-app-dev
            rootDir: frontend
            buildCommand: npm install && npm run build
            staticPublishPath: dist
            routes:
              - type: rewrite
                source: /*
                destination: /index.html
            envVars:
              - key: VITE_API_URL
                value: https://apiimp.netic.dev
              - key: VITE_SOCKET_URL
                value: https://apiimp.netic.dev
